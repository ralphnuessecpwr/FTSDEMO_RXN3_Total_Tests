variables:
    cesUri:                 http://cwcc.compuware.com:2020
    hostUri:                cwcc.compuware.com
    hostPort:               16196
    hostCodePage:           1047
    topazCliWorkspace:      .\TopazCliWkspc
    ispwConfig:             ispw
    ccSystem:               AZURE_$ispwSet
    sonarProjectName:       RNU_$ispwApplication_GitLab
    sonarSources:           .\$ispwApplication\MF_Source
    tttEnvironment:         5b508b8a787be73b59238d38
    testFolderVt:           tests/Virtualized_Tests
    testResultFolderVt:     ./TTTSonar/Virtualized_Tests.cli.suite.sonar.xml
    codeCoverageReportFile: Coverage/CodeCoverage.xml
    ispwTargetLevel:        QA1

stages:
    - mf-sources
    - tests

mf-sources:
    stage: mf-sources
    variables:
        ispwTargetLevel: QA1
    rules:
        - if: $ispwSrcLevel == 'DEV2'
          variables:
            ispwTargetLevel: QA2
        - if: $ispwSrcLevel == 'DEV3'
          variables:
            ispwTargetLevel: QA3
        - if: $ispwSrcLevel == 'FIX'
          variables:
            ispwTargetLevel: EMR
    script: |
        echo "Getting Sources from Mainframe for"
        echo "Stream $ispwStream"
        echo "Application $ispwApplication"
        echo "Assignment $ispwAssignment"
        echo "Set $ispwSet"
        echo "Source Level $ispwSrcLevel"
        echo "Target Level $ispwTargetLevel"
        echo "Ownder $ispwOwner"
        cmd.exe /c $cliPath'\SCMDownloaderCLI.bat -host '$hostUri' -port '$hostPort' -id '$hostUser' -pass '$hostPassword' -protocol None -code '$hostCodePage' -timeout 0 -targetFolder .\ -data '$topazCliWorkspace' -ispwServerConfig '$ispwConfig' -scm ispwc -ispwContainerName '$ispwSet' -ispwContainerType 2 -ispwServerLevel '$ispwTargetLevel' -ispwDownloadAll true'
    artifacts:
        paths: 
            - ./
        when: always

tests:
    stage: tests
    script: |
        echo "Target Lev $ispwTargetLevel"
        cmd.exe /c $cliPath'\TotalTestFTCLI.bat -data '$cliWorkpace' -e '$tttEnvironment' -u '$hostUser -p '$hostPassword' -s '$cesUri'/totaltestapi/ -cesu '$hostUser' -cesp '$hostPassword' -f '$testFolderVt' -pnf changedPrograms.json -ccrepo '$ccRepo' -ccsys '$ccSystem' -cctid '$ccTestid' -ccclear true -ctxvars '$contextVars' -R -G -v 6 -l jenkins -loglevel INFO'